<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>AR Kisah Nabi-Nabi</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      .playButton {
        position: absolute;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        padding: 10px 20px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 5px;
        z-index: 1000;
        display: none;
      }
    </style>
  </head>
  <body>
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <!-- === Marker Nabi Nuh === -->
      <a-marker type="pattern" url="pattern-kapallau.patt" id="nuh-marker">
        <a-entity id="nuh-ship" gltf-model="url(sailing_ship_model.glb)" scale="0.25 0.25 0.25" position="-1.2 -3 -0.3" visible="false"></a-entity>

        <!-- Cards Nabi Nuh -->
        <a-entity id="nuh-first-card" visible="false">
          <a-plane position="0 0.4 0.6" width="1.2" height="0.4" color="#ff0000" opacity="0"
            animation="property: opacity; to: 0.9; dur: 1000; startEvents: fade-in"></a-plane>
          <a-text value="Nabi Nuh a.s.\nSalah satu Nabi Ulul Azmi" align="center" color="#ffffff"
            position="0 0.4 0.61" scale="0.4 0.4 0.4" opacity="0"
            animation="property: opacity; to: 1; dur: 1500; startEvents: fade-in"></a-text>
        </a-entity>

        <a-entity id="nuh-second-card" visible="false">
          <a-plane position="0 0.4 0.6" width="1.2" height="0.4" color="#ff0000" opacity="0"
            animation="property: opacity; to: 0.9; dur: 1000; startEvents: show-second"></a-plane>
          <a-text value="Gambar hanya ilustrasi" align="center" color="#ffffff"
            position="0 0.4 0.61" scale="0.4 0.4 0.4" opacity="0"
            animation="property: opacity; to: 1; dur: 1500; startEvents: show-second"></a-text>
        </a-entity>

        <a-entity id="nuh-story-card" visible="false">
          <a-plane position="0 0.4 0.6" width="1.8" height="1.2" color="#333333" opacity="0"
            animation="property: opacity; to: 0.9; dur: 1000; startEvents: show-story"></a-plane>
          <a-text value="Kisah Nabi Nuh" align="center" color="#ffffff"
            position="0 0.9 0.61" width="2.5" opacity="0"
            animation="property: opacity; to: 1; dur: 1500; startEvents: show-story"></a-text>
          <a-text value="Nabi Nuh diutus Allah untuk\nmemperingatkan kaumnya..."
            align="center" color="#ffffff" position="0 0.4 0.61" width="2" wrap-count="30"
            opacity="0" scale="0.7 0.7 0.7"
            animation="property: opacity; to: 1; dur: 2000; startEvents: show-story; delay: 500"></a-text>
        </a-entity>
      </a-marker>

      <!-- === Marker Nabi Isa === -->
      <a-marker type="pattern" url="NabiIsa.patt" id="isa-marker">
        <a-entity id="isa-model" gltf-model="url(nabi_isa.glb)" scale="0.6 0.6 0.6" position="0 -1.2 -1.2" rotation="0 180 0" visible="false"></a-entity>

        <!-- Cards Nabi Isa -->
        <a-entity id="isa-first-card" visible="false">
          <a-plane position="0 0.4 0.6" width="1.2" height="0.4" color="#ff0000" opacity="0"
            animation="property: opacity; to: 0.9; dur: 1000; startEvents: fade-in"></a-plane>
          <a-text value="Nabi Isa a.s.\nSalah satu Nabi Ulul Azmi" align="center" color="#ffffff"
            position="0 0.4 0.61" scale="0.4 0.4 0.4" opacity="0"
            animation="property: opacity; to: 1; dur: 1500; startEvents: fade-in"></a-text>
        </a-entity>

        <a-entity id="isa-second-card" visible="false">
          <a-plane position="0 0.4 0.6" width="1.2" height="0.4" color="#ff0000" opacity="0"
            animation="property: opacity; to: 0.9; dur: 1000; startEvents: show-second"></a-plane>
          <a-text value="Gambar hanya ilustrasi" align="center" color="#ffffff"
            position="0 0.4 0.61" scale="0.4 0.4 0.4" opacity="0"
            animation="property: opacity; to: 1; dur: 1500; startEvents: show-second"></a-text>
        </a-entity>

        <a-entity id="isa-story-card" visible="false">
          <a-plane
            position="0 0.4 0.6"
            width="1.8"
            height="1.2"
            color="#333333"
            opacity="0"
            animation="property: opacity; to: 0.9; dur: 1000; startEvents: show-story"
          >
          </a-plane>
          <a-text
            value="Kisah Nabi Isa"
            align="center"
            color="#ffffff"
            position="0 0.9 0.61"
            width="2.5"
            opacity="0"
            animation="property: opacity; to: 1; dur: 1500; startEvents: show-story"
          >
          </a-text>
          <a-text
            value="5 Mukjizat Nabi Isa a.s.:\n\n1. Diciptakan tanpa ayah\n2. Bicara sejak bayi\n3. Membentuk burung dari tanah\n4. Menyembuhkan penyakit\n5. Menghidupkan orang mati"
            align="center"
            color="#ffffff"
            position="0 0.4 0.61"
            width="2"
            opacity="0"
            wrap-count="30"
            scale="0.7 0.7 0.7"
            animation="property: opacity; to: 1; dur: 2000; startEvents: show-story; delay: 500"
          >
          </a-text>
        </a-entity>


      </a-marker>

      <!-- Assets -->
      <a-assets>
        <audio id="narasi-nuh" src="KisahNabiNuh.mp3" preload="auto"></audio>
        <audio id="narasi-isa" src="nabi_isa.mp3" preload="auto"></audio>
      </a-assets>

      <a-entity camera></a-entity>
    </a-scene>

    <button id="play-nuh" class="playButton">Putar Narasi Nabi Nuh</button>
    <button id="play-isa" class="playButton">Putar Narasi Nabi Isa</button>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // === Fungsi umum reset elemen dengan opacity ===
        const resetVisibility = () => {
          document.querySelectorAll("[opacity]").forEach(el => {
            el.setAttribute("opacity", "0");
          });
        };

        // === Marker Nabi Nuh ===
        const nuhMarker = document.getElementById("nuh-marker");
        const playNuhBtn = document.getElementById("play-nuh");
        const audioNuh = document.getElementById("narasi-nuh");

        nuhMarker.addEventListener("markerFound", () => {
          document.getElementById("nuh-ship").setAttribute("visible", "true");
          const first = document.getElementById("nuh-first-card");
          const second = document.getElementById("nuh-second-card");
          const story = document.getElementById("nuh-story-card");

          first.setAttribute("visible", true);
          first.querySelector("a-plane").emit("fade-in");
          first.querySelector("a-text").emit("fade-in");

          setTimeout(() => {
            first.setAttribute("visible", false);
            second.setAttribute("visible", true);
            second.querySelector("a-plane").emit("show-second");
            second.querySelector("a-text").emit("show-second");

            setTimeout(() => {
              second.setAttribute("visible", false);
              story.setAttribute("visible", true);
              story.querySelector("a-plane").emit("show-story");
              story.querySelectorAll("a-text").forEach(el => el.emit("show-story"));

              playNuhBtn.style.display = "block";
              playNuhBtn.onclick = () => {
                audioNuh.play();
                playNuhBtn.style.display = "none";
              };
              audioNuh.play().catch(() => {});
            }, 3000);
          }, 3000);
        });

        nuhMarker.addEventListener("markerLost", () => {
          ["nuh-ship", "nuh-first-card", "nuh-second-card", "nuh-story-card"].forEach(id => {
            document.getElementById(id).setAttribute("visible", false);
          });
          playNuhBtn.style.display = "none";
          audioNuh.pause(); audioNuh.currentTime = 0;
          resetVisibility();
        });

        // === Marker Nabi Isa ===
        const isaMarker = document.getElementById("isa-marker");
        const playIsaBtn = document.getElementById("play-isa");
        const audioIsa = document.getElementById("narasi-isa");

        isaMarker.addEventListener("markerFound", () => {
          document.getElementById("isa-model").setAttribute("visible", "true");
          const first = document.getElementById("isa-first-card");
          const second = document.getElementById("isa-second-card");
          const story = document.getElementById("isa-story-card");

          first.setAttribute("visible", true);
          first.querySelector("a-plane").emit("fade-in");
          first.querySelector("a-text").emit("fade-in");

          setTimeout(() => {
            first.setAttribute("visible", false);
            second.setAttribute("visible", true);
            second.querySelector("a-plane").emit("show-second");
            second.querySelector("a-text").emit("show-second");

            setTimeout(() => {
              second.setAttribute("visible", false);
              story.setAttribute("visible", true);
              story.querySelector("a-plane").emit("show-story");
              story.querySelectorAll("a-text").forEach(el => el.emit("show-story"));

              playIsaBtn.style.display = "block";
              playIsaBtn.onclick = () => {
                audioIsa.play();
                playIsaBtn.style.display = "none";
              };
              audioIsa.play().catch(() => {});
            }, 3000);
          }, 3000);
        });

        isaMarker.addEventListener("markerLost", () => {
          ["isa-model", "isa-first-card", "isa-second-card", "isa-story-card"].forEach(id => {
            document.getElementById(id).setAttribute("visible", false);
          });
          playIsaBtn.style.display = "none";
          audioIsa.pause(); audioIsa.currentTime = 0;
          resetVisibility();
        });
      });
    </script>
  </body>
</html>
